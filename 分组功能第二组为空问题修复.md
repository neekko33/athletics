# âœ… åˆ†ç»„åŠŸèƒ½ç¬¬äºŒç»„ä¸ºç©ºé—®é¢˜ä¿®å¤

## é—®é¢˜æè¿°

å½“åŒä¸€ä¸ªå¹´çº§åŒä¸€ä¸ªé¡¹ç›®å‡ºçŽ°å¤šä¸ªåˆ†ç»„æ—¶ï¼Œç¬¬äºŒä¸ªåˆ†ç»„æ²¡æœ‰è¿åŠ¨å‘˜ï¼Œæ˜¾ç¤ºä¸ºç©ºã€‚

ä¾‹å¦‚ï¼š
- ä¸€å¹´çº§ç”·å­100ç±³æœ‰10åè¿åŠ¨å‘˜
- èµ›é“æ•°æ˜¯6æ¡
- åº”è¯¥ç”Ÿæˆ2ä¸ªç»„ï¼ˆç¬¬1ç»„6äººï¼Œç¬¬2ç»„4äººï¼‰
- **å®žé™…ç»“æžœ**ï¼šç¬¬1ç»„æ­£å¸¸ï¼Œç¬¬2ç»„ä¸ºç©º

## é—®é¢˜åŽŸå› 

### æ ¹æœ¬åŽŸå› ï¼šLaravel Collection çš„ `slice()` ä¿ç•™åŽŸå§‹é”®

åœ¨PHP/Laravelä¸­ï¼Œ`slice()` æ–¹æ³•åˆ‡ç‰‡åŽ**ä¿ç•™åŽŸå§‹æ•°ç»„/é›†åˆçš„é”®**ï¼Œè€Œä¸æ˜¯é‡æ–°ä»Ž0å¼€å§‹ç¼–å·ã€‚

### é—®é¢˜ä»£ç 

```php
$shuffledAthletes = $gradeAthletes->shuffle();

for ($i = 0; $i < $heatCount; $i++) {
    $heatAthletes = $shuffledAthletes->slice($i * $maxLanes, $maxLanes);
    
    foreach ($heatAthletes as $index => $athlete) {
        $lane = $heat->lanes()->create([
            'lane_number' => $index + 1  // é—®é¢˜åœ¨è¿™é‡Œï¼
        ]);
    }
}
```

### é—®é¢˜æ¼”ç¤º

å‡è®¾æœ‰8åè¿åŠ¨å‘˜ï¼Œèµ›é“æ•°ä¸º4ï¼š

**ç¬¬1ç»„ (slice(0, 4))**ï¼š
```
Key: 0 â†’ lane_number: 1 âœ…
Key: 1 â†’ lane_number: 2 âœ…
Key: 2 â†’ lane_number: 3 âœ…
Key: 3 â†’ lane_number: 4 âœ…
```

**ç¬¬2ç»„ (slice(4, 4))**ï¼š
```
Key: 4 â†’ lane_number: 5 âŒ (åº”è¯¥æ˜¯1)
Key: 5 â†’ lane_number: 6 âŒ (åº”è¯¥æ˜¯2)
Key: 6 â†’ lane_number: 7 âŒ (åº”è¯¥æ˜¯3)
Key: 7 â†’ lane_number: 8 âŒ (åº”è¯¥æ˜¯4)
```

ç”±äºŽ `lane_number` è¶…è¿‡äº† `total_lanes`ï¼ˆ4æ¡èµ›é“ï¼‰ï¼Œå¯¼è‡´ï¼š
- åˆ›å»ºäº† lane_number ä¸º 5ã€6ã€7ã€8 çš„èµ›é“ï¼ˆè¶…å‡ºèŒƒå›´ï¼‰
- è§†å›¾ä¸­åªæ˜¾ç¤º1-4å·èµ›é“
- ç»“æžœï¼šç¬¬2ç»„çœ‹èµ·æ¥æ˜¯ç©ºçš„ï¼ˆå®žé™…ä¸Šè¿åŠ¨å‘˜è¢«åˆ†é…åˆ°äº†5-8å·èµ›é“ï¼‰

## è§£å†³æ–¹æ¡ˆ

ä½¿ç”¨ `values()` æ–¹æ³•é‡ç½®é›†åˆçš„é”®ä¸ºè¿žç»­çš„æ•´æ•°ï¼ˆ0, 1, 2, ...ï¼‰

### ä¿®å¤åŽçš„ä»£ç 

```php
// ä¿®å¤1: shuffleåŽé‡ç½®é”®
$shuffledAthletes = $gradeAthletes->shuffle()->values();

for ($i = 0; $i < $heatCount; $i++) {
    // ä¿®å¤2: sliceåŽé‡ç½®é”®
    $heatAthletes = $shuffledAthletes->slice($i * $maxLanes, $maxLanes)->values();
    
    foreach ($heatAthletes as $index => $athlete) {
        $lane = $heat->lanes()->create([
            'lane_number' => $index + 1  // çŽ°åœ¨æ­£ç¡®äº†ï¼
        ]);
    }
}
```

### ä¿®å¤åŽçš„æ•ˆæžœ

**ç¬¬1ç»„ (slice(0, 4)->values())**ï¼š
```
Key: 0 â†’ lane_number: 1 âœ…
Key: 1 â†’ lane_number: 2 âœ…
Key: 2 â†’ lane_number: 3 âœ…
Key: 3 â†’ lane_number: 4 âœ…
```

**ç¬¬2ç»„ (slice(4, 4)->values())**ï¼š
```
Key: 0 â†’ lane_number: 1 âœ…
Key: 1 â†’ lane_number: 2 âœ…
Key: 2 â†’ lane_number: 3 âœ…
Key: 3 â†’ lane_number: 4 âœ…
```

## ä¿®å¤çš„æ–‡ä»¶å’Œæ–¹æ³•

### HeatController.php

ä¿®å¤äº†ä»¥ä¸‹3ä¸ªæ–¹æ³•ï¼š

#### 1. generateTrackHeats() - æ™®é€šå¾„èµ›åˆ†ç»„

**ä¿®æ”¹ä½ç½®**ï¼š
```php
// ç¬¬229è¡Œé™„è¿‘
$shuffledAthletes = $gradeAthletes->shuffle()->values(); // æ·»åŠ  ->values()

// ç¬¬236è¡Œé™„è¿‘
$heatAthletes = $shuffledAthletes->slice($i * $maxLanes, $maxLanes)->values(); // æ·»åŠ  ->values()
```

#### 2. generateLongDistanceHeats() - é•¿è·ç¦»é¡¹ç›®åˆ†ç»„

**ä¿®æ”¹ä½ç½®**ï¼š
```php
// ç¬¬279è¡Œé™„è¿‘
$shuffledAthletes = $gradeAthletes->shuffle()->values(); // æ·»åŠ  ->values()
```

#### 3. generateFieldEvents() - ç”°èµ›åˆ†ç»„

**ä¿®æ”¹ä½ç½®**ï¼š
```php
// ç¬¬343è¡Œé™„è¿‘
$shuffledAthletes = $gradeAthletes->shuffle()->values(); // æ·»åŠ  ->values()
```

## å½±å“èŒƒå›´

### å—å½±å“çš„é¡¹ç›®ç±»åž‹

1. âœ… **æ™®é€šå¾„èµ›**ï¼ˆ100ç±³ã€200ç±³ã€400ç±³ç­‰ï¼‰- å½“äººæ•° > track_lanes æ—¶
2. âœ… **é•¿è·ç¦»é¡¹ç›®**ï¼ˆ800ç±³ã€1000ç±³ã€1500ç±³ï¼‰- ç†è®ºä¸Šä¸ä¼šåˆ†å¤šç»„ï¼Œä½†ä»£ç ç»Ÿä¸€ä¿®å¤
3. âœ… **ç”°èµ›é¡¹ç›®**ï¼ˆè·³é«˜ã€è·³è¿œã€é“…çƒç­‰ï¼‰- æ¯ä¸ªå¹´çº§åªæœ‰ä¸€ç»„ï¼Œä½†ä»£ç ç»Ÿä¸€ä¿®å¤

### æŽ¥åŠ›é¡¹ç›®ä¸å—å½±å“

æŽ¥åŠ›é¡¹ç›®ä½¿ç”¨ä¸åŒçš„ç®—æ³•ï¼ˆ`generateRelayHeats()`ï¼‰ï¼Œä¸ä½¿ç”¨ `slice()` æ–¹æ³•ï¼Œå› æ­¤ä¸å—æ­¤é—®é¢˜å½±å“ã€‚

## æµ‹è¯•éªŒè¯

### æµ‹è¯•åœºæ™¯1ï¼šæ™®é€šå¾„èµ›å¤šç»„

**æ¡ä»¶**ï¼š
- ä¸€å¹´çº§ç”·å­100ç±³
- 10åè¿åŠ¨å‘˜
- 6æ¡èµ›é“

**é¢„æœŸç»“æžœ**ï¼š
- ç¬¬1ç»„ï¼š6äººï¼ˆèµ›é“1-6ï¼‰
- ç¬¬2ç»„ï¼š4äººï¼ˆèµ›é“1-4ï¼‰

### æµ‹è¯•åœºæ™¯2ï¼šäººæ•°åˆšå¥½

**æ¡ä»¶**ï¼š
- äºŒå¹´çº§å¥³å­200ç±³
- 12åè¿åŠ¨å‘˜
- 6æ¡èµ›é“

**é¢„æœŸç»“æžœ**ï¼š
- ç¬¬1ç»„ï¼š6äººï¼ˆèµ›é“1-6ï¼‰
- ç¬¬2ç»„ï¼š6äººï¼ˆèµ›é“1-6ï¼‰

### æµ‹è¯•åœºæ™¯3ï¼šä¸‰ä¸ªç»„

**æ¡ä»¶**ï¼š
- ä¸‰å¹´çº§ç”·å­400ç±³
- 16åè¿åŠ¨å‘˜
- 6æ¡èµ›é“

**é¢„æœŸç»“æžœ**ï¼š
- ç¬¬1ç»„ï¼š6äººï¼ˆèµ›é“1-6ï¼‰
- ç¬¬2ç»„ï¼š6äººï¼ˆèµ›é“1-6ï¼‰
- ç¬¬3ç»„ï¼š4äººï¼ˆèµ›é“1-4ï¼‰

## Laravel Collection çŸ¥è¯†ç‚¹

### slice() æ–¹æ³•

```php
$collection = collect([0, 1, 2, 3, 4, 5, 6, 7]);
$slice = $collection->slice(4, 4);
// ç»“æžœ: [4 => 4, 5 => 5, 6 => 6, 7 => 7]
// æ³¨æ„ï¼šé”®ä»ç„¶æ˜¯ 4, 5, 6, 7
```

### values() æ–¹æ³•

```php
$collection = collect([0, 1, 2, 3, 4, 5, 6, 7]);
$slice = $collection->slice(4, 4)->values();
// ç»“æžœ: [0 => 4, 1 => 5, 2 => 6, 3 => 7]
// é”®è¢«é‡ç½®ä¸º 0, 1, 2, 3
```

### ä½•æ—¶éœ€è¦ values()

å½“ä½ éœ€è¦ä½¿ç”¨æ•°ç»„ç´¢å¼•ä½œä¸º**ä½ç½®ä¿¡æ¯**æ—¶ï¼ˆå¦‚èµ›é“å·ã€ä½ç½®å·ï¼‰ï¼Œå¿…é¡»ä½¿ç”¨ `values()` é‡ç½®é”®ï¼š

```php
// âŒ é”™è¯¯ï¼šé”®å¯èƒ½ä¸è¿žç»­
foreach ($collection as $index => $item) {
    echo "Position: " . ($index + 1); // å¯èƒ½å¾—åˆ° 5, 6, 7...
}

// âœ… æ­£ç¡®ï¼šé”®æ€»æ˜¯ä»Ž0å¼€å§‹è¿žç»­
foreach ($collection->values() as $index => $item) {
    echo "Position: " . ($index + 1); // æ€»æ˜¯å¾—åˆ° 1, 2, 3...
}
```

## ç±»ä¼¼é—®é¢˜é¢„é˜²

åœ¨ä»¥åŽçš„ä»£ç ä¸­ï¼Œæ³¨æ„ä»¥ä¸‹åœºæ™¯ï¼š

1. âœ… ä½¿ç”¨ `shuffle()` åŽè¦ `->values()`
2. âœ… ä½¿ç”¨ `slice()` åŽè¦ `->values()`
3. âœ… ä½¿ç”¨ `filter()` åŽè¦ `->values()`
4. âœ… ä½¿ç”¨ `groupBy()` åŽçš„æ¯ä¸ªåˆ†ç»„è¦ `->values()`
5. âœ… ä½¿ç”¨ `map()` è¿”å›žéƒ¨åˆ†å…ƒç´ æ—¶è¦ `->values()`

## æ€»ç»“

è¿™æ˜¯ä¸€ä¸ªå…¸åž‹çš„**æ•°ç»„é”®ä¿ç•™**é—®é¢˜ï¼Œåœ¨å¾ˆå¤šç¼–ç¨‹è¯­è¨€ä¸­éƒ½ä¼šé‡åˆ°ã€‚Laravelçš„Collectionæä¾›äº†`values()`æ–¹æ³•æ¥ä¼˜é›…åœ°è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

**è®°ä½å£è¯€**ï¼š
> åˆ‡ç‰‡æ‰“ä¹±è¿‡æ»¤åŽï¼Œvalues()ä¸èƒ½å°‘ï¼

---

**ä¿®å¤æ—¶é—´**: 2025å¹´10æœˆ5æ—¥
**å½±å“æ–¹æ³•**: 3ä¸ªï¼ˆgenerateTrackHeatsã€generateLongDistanceHeatsã€generateFieldEventsï¼‰
**æµ‹è¯•çŠ¶æ€**: âœ… å·²éªŒè¯
**ç´§æ€¥ç¨‹åº¦**: ðŸ”´ é«˜ï¼ˆå½±å“æ ¸å¿ƒåŠŸèƒ½ï¼‰
**ä¿®å¤éš¾åº¦**: ðŸŸ¢ ç®€å•ï¼ˆæ·»åŠ ->values()ï¼‰
